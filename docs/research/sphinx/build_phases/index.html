

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Phases &mdash; Detailed Sphinx 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../static/documentation_options.js"></script>
        <script src="../../../static/jquery.js"></script>
        <script src="../../../static/underscore.js"></script>
        <script src="../../../static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Read" href="../read/" />
    <link rel="prev" title="App Initialization" href="../app_init/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../" class="icon icon-home"> Detailed Sphinx
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Deep Investigation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tools/">The Tracking Tool</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Sphinx</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../top/">Top Level Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_init/">App Initialization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building Phases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../read/">Read</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docutils/">Docutils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Detailed Sphinx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../">Docs</a> &raquo;</li>
        
          <li><a href="../../">Deep Investigation</a> &raquo;</li>
        
          <li><a href="../">Sphinx</a> &raquo;</li>
        
      <li>Building Phases</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/research/sphinx/build_phases/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This draft documentation is under development.</p>
</div>
<section id="building-phases">
<span id="research-sphinx-process-phases"></span><h1>Building Phases<a class="headerlink" href="#building-phases" title="Permalink to this heading">Â¶</a></h1>
<div class="graphviz"><img src="../../../images/graphviz-4b6825f3852da932e5a031675f7a8982fca88845.png" alt="digraph {
//	graph [rankdir=LR]
	node [color=none fillcolor=lightgrey shape=cds style=filled]
	&quot;init&quot; [label=INITIALIZATION href=&quot;../app_init/&quot; target=_top]
	&quot;read&quot; [label=&lt;&lt;b&gt;READING&lt;/b&gt;&gt; fillcolor=cadetblue4 fontcolor=white href=&quot;../read/&quot; target=_top]
	&quot;consistency&quot; [label=&lt;&lt;b&gt;CONSISTENCY_CHECK&lt;/b&gt;&gt; fillcolor=cadetblue4 fontcolor=white href=&quot;../consistency/&quot; target=_top]
	&quot;resolve&quot; [label=&lt;&lt;b&gt;RESOLVING&lt;/b&gt;&gt; fillcolor=cadetblue4 fontcolor=white href=&quot;../resolve/&quot; target=_top]
	&quot;write&quot; [label=&lt;&lt;b&gt;WRITING&lt;/b&gt;&gt; fillcolor=cadetblue4 fontcolor=white href=&quot;../sphinx/write/&quot; target=_top]
}" usemap="#grapvizdd93b1ba79" class="graphviz" /></div>
<map id="grapvizdd93b1ba79" name="grapvizdd93b1ba79">
<area shape="rect" id="node1" href="../app_init/" target="_top" title="INITIALIZATION" alt="" coords="5,5,164,53"/>
<area shape="rect" id="node2" href="../read/" target="_top" title="&lt;b&gt;READING&lt;/b&gt;" alt="" coords="188,5,296,53"/>
<area shape="rect" id="node3" href="../consistency/" target="_top" title="&lt;b&gt;CONSISTENCY_CHECK&lt;/b&gt;" alt="" coords="320,5,551,53"/>
<area shape="rect" id="node4" href="../resolve/" target="_top" title="&lt;b&gt;RESOLVING&lt;/b&gt;" alt="" coords="575,5,707,53"/>
<area shape="rect" id="node5" href="../sphinx/write/" target="_top" title="&lt;b&gt;WRITING&lt;/b&gt;" alt="" coords="731,5,839,53"/>
</map><p>The building phases start with the <code class="docutils literal notranslate"><span class="pre">app.build</span></code> method called by the <code class="docutils literal notranslate"><span class="pre">build_main</span></code> function
after completing the INITIALIZATION phase as presented earlier in <a class="reference internal" href="../top/#research-sphinx-process-top"><span class="std std-ref">Top Level Operations</span></a>.</p>
<p>The main steps of the process are presented on the following diagram:</p>
<p class="plantuml">
<img src="../../../images/plantuml-62017a59390bd78cea19c314bf149879c23b3107.png" alt="&#64;startuml
skinparam ArrowFontColor red
'   NoteBackgroundColor&lt;&lt; phase &gt;&gt; CadetBlue
'   NoteFontColor&lt;&lt; phase &gt;&gt; White

package &quot;sphinx&quot; {
   (build_main)
   package &quot;application&quot; {
      folder &quot;Sphinx&quot; {
         [build] as app_build
         note right of app_build #CadetBlue
            &lt;font color=white&gt;READING&lt;/font&gt;
            declared
         end note
      }
      note left of Sphinx: app
   }


   package &quot;builders&quot; {
      package &quot;dirhtml&quot; {
         folder &quot;StandaloneHTMLBuilder&quot; {
            [build_update:\n  to_build = self.get_outdated_docs();\n  self.build(to_build)] as builder_update
            [get_outdated_docs:\n  for docname in self.env.found_docs:] as get_outdated
            [build\n                  ] as builder_build
            [read] as builder_read
            [write] as builder_write
            note top of get_outdated: Getting doc names
               note left of get_outdated #CadetBlue: &lt;font color=white&gt;READING&lt;/font&gt;

            note bottom of builder_write #CadetBlue : &lt;font color=white&gt;RESOLVING,&lt;/font&gt;
            note bottom of builder_write #CadetBlue : &lt;font color=white&gt;WRITING&lt;/font&gt;
'            note bottom of builder_write #CadetBlue
'               &lt;font color=white&gt;RESOLVING,&lt;/font&gt;
'               &lt;font color=white&gt;WRITING&lt;/font&gt;
'            end note
            note right of builder_build: Main orchestrator
            note left of builder_read #CadetBlue: &lt;font color=white&gt;READING&lt;/font&gt;

         }
      }
   }
   note top of StandaloneHTMLBuilder: app.builder

   package &quot;environment&quot; {
      folder &quot;BuildEnvironment&quot; {
'         [found_docs] as env_docs
'         together {
'            [find_files] as env_files
            [check_consistency] as consistency
'         }
         note bottom of consistency #CadetBlue: &lt;font color=white&gt;CONSISTENCY_CHECK&lt;/font&gt;
      }
   }
   note top of BuildEnvironment: app.env

'   note left of BuildEnvironment: app.env
'   note bottom of consistency: CONSISTENCY_CHECK

'   package &quot;project&quot; {
'      folder &quot;Project&quot; {
'         [docnames] as project_docnames
'         [discover] as project_discover
'      }
'   }
'   note bottom of Project: env.project\napp.env.project\napp.project
'
'   package &quot;domains&quot; {
'      folder &quot;Domain&quot; {
'         [check_consistency] as domain_consistency
'      }
'   }
'   note bottom of Domain: env.domains{[name], [Domain]}
}

build_main --&gt; app_build : &lt;1&gt;
app_build --&gt; builder_update : &lt;2&gt;
builder_update --&gt; get_outdated : &lt;3&gt;
'get_outdated --&gt; env_docs : &lt;4&gt;
'env_docs --&gt; project_docnames
builder_update --&gt; builder_build : &lt;4&gt;
builder_build --&gt; builder_read: &lt;5&gt;
builder_build --&gt; builder_write: &lt;7&gt;
'builder_write --&gt; env_docs
'builder_read --&gt; env_files
'env_files --&gt; project_discover
builder_build --&gt; consistency: &lt;6&gt;
'consistency --&gt; domain_consistency

get_outdated -[hidden]right-&gt; builder_build
builder_read -[hidden]&gt; builder_write
builder_write -[hidden]&gt; consistency
'env_docs -[hidden]&gt; env_files
'env_files -[hidden]&gt; consistency
'project_docnames -[hidden]&gt; project_discover
'project_discover -[hidden]&gt; domain_consistency
&#64;enduml"/>
</p>
<p>Sphinx executes the build phases in the following order at the top level (see the diagram for the order numbers):</p>
<ol class="arabic">
<li><p>Start the build phases by calling the <code class="docutils literal notranslate"><span class="pre">app.build</span></code> method.
First, it declares the start of the READING phase.
Depending on the command arguments and the source state, it calls one of the following methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">build_all</span></code> if the <code class="docutils literal notranslate"><span class="pre">sphinx-build</span></code> command requires to rebuild all documents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_specific</span></code> if the command requires to build the specific files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_update</span></code> to process the updated source files and build the documents from them.
This is the default behaviour used when the other two are not required.
This method is considered in the following steps.</p></li>
</ul>
<p>When the called method completes, the <code class="docutils literal notranslate"><span class="pre">app.build</span></code> method cleans up the build environment
and prints the summary results of all the phases.</p>
</li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.build.build_update</span></code> method that initiates collection of source data and starts
the build orchestration method.</p></li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.build.get_outdated_docs</span></code> method to get a list of updated documents. It returns a generator
of the discovered source files, so that the <code class="docutils literal notranslate"><span class="pre">to_build</span></code> variable will yield source file paths similar to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">to_build</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;folder1/index&#39;</span><span class="p">,</span> <span class="s1">&#39;folder2/index&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This data is taken from the <code class="docutils literal notranslate"><span class="pre">env.found_docs</span></code> property method, which in its turn read it from <code class="docutils literal notranslate"><span class="pre">project.docnames</span></code>.
The latter was prepare during <a class="reference internal" href="../app_init/#research-sphinx-process-app"><span class="std std-ref">INITIALIZATION</span></a>.</p>
</li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.build.build</span></code> method that works as the phase orchestrator.
It receives a list of source file paths and a phrase for printing similar to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">targets</span> <span class="k">for</span> <span class="mi">3</span> <span class="n">source</span> <span class="n">files</span> <span class="n">that</span> <span class="n">are</span> <span class="n">out</span> <span class="n">of</span> <span class="n">date</span>
</pre></div>
</div>
</li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.build.read</span></code> method that implements the main part of the READING phase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">logging</span><span class="o">.</span><span class="n">pending_warnings</span><span class="p">():</span>
   <span class="n">updated_docnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>At this phase, Sphinx works closely with Docutils to parse each source document and obtain the hierarchical
node structure.</p>
</li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.env.check_consistency</span></code> method to check that all source documents are added to the
<code class="docutils literal notranslate"><span class="pre">env.files_to_rebuild</span></code> list except for the root document, orphans, and documents included by other
documents. The method also checks for domain consistency by calling the <code class="docutils literal notranslate"><span class="pre">domain.check_consistency</span></code> method
for each domain in the <code class="docutils literal notranslate"><span class="pre">env.domains</span></code> dictionary. In the example considered here, the method works with
the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">env.all_docs</span></code>: <code class="docutils literal notranslate"><span class="pre">{'folder1/index':</span> <span class="pre">1676118279.329916,</span> <span class="pre">'folder2/index':</span> <span class="pre">1676118279.332646,</span> <span class="pre">'index':</span> <span class="pre">1676118279.337593}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">env.files_to_rebuild</span></code>: <code class="docutils literal notranslate"><span class="pre">{'folder1/index':</span> <span class="pre">{'index'},</span> <span class="pre">'folder2/index':</span> <span class="pre">{'index'}}</span></code></p></li>
<li><p>Domains: <code class="docutils literal notranslate"><span class="pre">c.CDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">changeset.ChangeSetDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">citation.CitationDomain</span></code>, cpp.CPPDomain,
<code class="docutils literal notranslate"><span class="pre">index.IndexDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">.javascript.JavaScriptDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">math.MathDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">python.PythonDomain</span></code>,
<code class="docutils literal notranslate"><span class="pre">rst.ReSTDomain</span></code>, <code class="docutils literal notranslate"><span class="pre">std.StandardDomain</span></code></p></li>
</ul>
<p>Finally, the method emits the <code class="docutils literal notranslate"><span class="pre">env-check-consistency</span></code> event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;env-check-consistency&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is where you can handle the event emitted after the source documents are checked
on consistency.</p>
</div>
</li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">app.build.write</span></code> method to implement the RESOLVING and WRITING phases.</p></li>
</ol>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../read/" class="btn btn-neutral float-right" title="Read" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../app_init/" class="btn btn-neutral float-left" title="App Initialization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Albert Bagdasarian

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
