@startuml
skinparam ArrowFontColor red
'   NoteBackgroundColor<< phase >> CadetBlue
'   NoteFontColor<< phase >> White

package "sphinx" {
   package "application" {
      folder "Sphinx" {
         [build] as app_build
         note right of app_build #CadetBlue: <font color=white>READING</font>
      }
   note left of Sphinx: app
   }


   package "builders" {
      package "dirhtml" {
         folder "StandaloneHTMLBuilder" {
            [build_update:\n  to_build = self.get_outdated_docs();\n  self.build(to_build)] as builder_update
            [get_outdated_docs:\n  for docname in self.env.found_docs:] as get_outdated
            [build\n                  ] as builder_build
            [read] as builder_read
            [write] as builder_write
            note top of get_outdated: Getting doc names
            note bottom of builder_write #CadetBlue
               <font color=white>RESOLVING,</font>
               <font color=white>WRITING</font>
            end note
            note left of builder_build: Main orchestrator
         }
      }
   }
   note top of StandaloneHTMLBuilder: app.builder

   package "environment" {
      folder "BuildEnvironment" {
'         [found_docs] as env_docs
'         together {
'            [find_files] as env_files
            [check_consistency] as consistency
'         }
         note bottom of consistency #CadetBlue: <font color=white>CONSISTENCY_CHECK</font>
      }
   }
   note top of BuildEnvironment: app.env

'   note left of BuildEnvironment: app.env
'   note bottom of consistency: CONSISTENCY_CHECK

'   package "project" {
'      folder "Project" {
'         [docnames] as project_docnames
'         [discover] as project_discover
'      }
'   }
'   note bottom of Project: env.project\napp.env.project\napp.project
'
'   package "domains" {
'      folder "Domain" {
'         [check_consistency] as domain_consistency
'      }
'   }
'   note bottom of Domain: env.domains{[name], [Domain]}
}

sphinx.build_main --> app_build : <1>
app_build --> builder_update : <2>
builder_update --> get_outdated : <3>
'get_outdated --> env_docs : <4>
'env_docs --> project_docnames
builder_update --> builder_build : <4>
builder_build --> builder_read: <5>
builder_build --> builder_write: <7>
'builder_write --> env_docs
'builder_read --> env_files
'env_files --> project_discover
builder_build --> consistency: <6>
'consistency --> domain_consistency

get_outdated -[hidden]right-> builder_build
builder_read -[hidden]> builder_write
builder_write -[hidden]> consistency
'env_docs -[hidden]> env_files
'env_files -[hidden]> consistency
'project_docnames -[hidden]> project_discover
'project_discover -[hidden]> domain_consistency
@enduml